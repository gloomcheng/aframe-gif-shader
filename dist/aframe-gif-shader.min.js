(()=>{var t={369:(t,e)=>{e.O=function(t,e,s){var r=0,a=[],i=0,_=null,n=null,h=[],o=0;if(71!==t[0]||73!==t[1]||70!==t[2]||56!==t[3]||57!==t[4]&&55!==t[4]||97!==t[5])s&&s("parseGIF: no GIF89a");else{r+=13+ +!!(128&t[10])*Math.pow(2,1+(7&t[10]))*3;for(var l=t.subarray(0,r);t[r]&&59!==t[r];){var c=r,u=t[r];if(33===u){var d=t[++r];if(-1===[1,254,249,255].indexOf(d)){s&&s("parseGIF: unknown label");break}for(249===d&&a.push(10*(t[r+3]+(t[r+4]<<8))),255===d&&(o=t[r+15]+(t[r+16]<<8));t[++r];)r+=t[r];249===d&&(_=t.subarray(c,r+1))}else{if(44!==u){s&&s("parseGIF: unknown blockId");break}for(r+=9,r+=1+ +!!(128&t[r])*(3*Math.pow(2,1+(7&t[r])));t[++r];)r+=t[r];n=t.subarray(c,r+1);var p={disposalMethod:_[3],blob:URL.createObjectURL(new Blob([l,_,n]))};h.push(p)}r++}}if(h.length){var f=document.createElement("canvas"),m=function(t){var s=new Image;s.onload=function(t,s){i++,h[s]=this,i===h.length?(f=null,e&&e(a,o,h)):m(++s)}.bind(s),s.src=f.toDataURL("image/gif")};!function(){for(var t=0;t<h.length;t++){var e=new Image;e.onload=function(t,s){0===s&&(f.width=e.width,f.height=e.height),i++,h[s]=this,i===h.length&&(i=0,m(1))}.bind(e,null,t),e.src=h[t].blob,e.disposalMethod=h[t].disposalMethod}}()}}}},e={};function s(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,s),i.exports}(()=>{"use strict";var t=s(369);if("undefined"==typeof AFRAME)throw"Component attempted to register before AFRAME was available.";const{parseUrl:e}=AFRAME.utils.srcLoader,{debug:r}=AFRAME.utils;r.enable("shader:gif:warn");const a=r("shader:gif:warn"),i=r("shader:gif:debug"),_={};function n(t,e){return{status:"error",src:e,message:t,timestamp:Date.now()}}AFRAME.registerShader("gif",{schema:{color:{type:"color"},fog:{default:!0},src:{type:"string",default:""},autoplay:{default:!0}},init(t){return i("init",t),i(this.el.components),this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d",{willReadFrequently:!0}),this.__texture=new THREE.Texture(this.__cnv),this.__texture.minFilter=THREE.LinearFilter,this.__texture.magFilter=THREE.LinearFilter,this.__texture.generateMipmaps=!1,this.__texture.colorSpace=THREE.SRGBColorSpace,this.__texture.premultiplyAlpha=!0,t.repeat&&(this.__texture.wrapS=THREE.RepeatWrapping,this.__texture.wrapT=THREE.RepeatWrapping,this.__texture.repeat.set(t.repeat.x,t.repeat.y)),this.__material={},this.__reset(),this.material=new THREE.MeshBasicMaterial({map:this.__texture,transparent:!0,premultipliedAlpha:!0}),this.el.sceneEl.addBehavior(this),this.material},update(t){return i("update",t),this.__updateMaterial(t),this.__updateTexture(t),this.material},tick(t){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial(t){const{material:e}=this,s=this.__getMaterialData(t);Object.keys(s).forEach((t=>{e[t]=s[t]}))},__getMaterialData:t=>({fog:t.fog,color:new THREE.Color(t.color)}),__setTexure(t){i("__setTexure",t),"error"===t.status?(a(`Error: ${t.message}\nsrc: ${t.src}`),this.__reset()):"success"===t.status&&t.src!==this.__textureSrc&&(this.__reset(),this.__ready(t))},__updateTexture(t){const{src:e,autoplay:s}=t;"boolean"==typeof s?this.__autoplay=s:void 0===s&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),e?this.__validateSrc(e,this.__setTexure.bind(this)):this.__reset()},__validateSrc(t,e){if(t)if(t.startsWith("#")){const s=this.__validateAndGetQuerySelector(t);if(!s||"object"!=typeof s)return void a(`Could not find element with selector: ${t}`);if(s.error)a(`Error: ${s.error}\nsrc: ${t}`),e(n(s.error,t));else{const r=s.tagName.toLowerCase();if("img"===r)s.complete?this.__getImageSrc(s.src,e):s.addEventListener("load",(()=>{this.__getImageSrc(s.src,e)}));else{const s=`For <${r}> element, please use \`aframe-html-shader\``;a(`Error: ${s}\nsrc: ${t}`),e(n(s,t))}}}else{const s=this.el.sceneEl.baseURI,r=new URL(t,s).href;this.__getImageSrc(r,e)}else a("src is not provided")},__getImageSrc(e,s){if(e===this.__textureSrc)return;let r=_[e];if(r&&r.callbacks){if(r.src)return void s(r);if(r.callbacks)return void r.callbacks.push(s)}else r=_[e]={callbacks:[]},r.callbacks.push(s);const a=new Image;function i(t){const s=n(t,e);r.callbacks&&(r.callbacks.forEach((t=>t(s))),_[e]=s)}a.crossOrigin="Anonymous",a.addEventListener("load",(s=>{this.__getUnit8Array(e,(s=>{s?(0,t.O)(s,((t,s,a)=>{const i={status:"success",src:e,times:t,cnt:s,frames:a,timestamp:Date.now()};r.callbacks&&(r.callbacks.forEach((t=>t(i))),_[e]=i)}),(t=>i(t))):i("This is not gif. Please use `shader:flat` instead")}))})),a.addEventListener("error",(t=>i("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue"))),a.src=e},__getUnit8Array(t,e){if("function"!=typeof e)return;const s=new XMLHttpRequest;s.open("GET",t),s.responseType="arraybuffer",s.addEventListener("load",(t=>{const s=new Uint8Array(t.target.response),r=s.subarray(0,4);let a="";for(let t=0;t<r.length;t++)a+=r[t].toString(16);"47494638"===a?e(s):e()})),s.addEventListener("error",(t=>{i(t),e()})),s.send()},__validateAndGetQuerySelector(t){try{return document.querySelector(t)||{error:"No element was found matching the selector"}}catch(t){return{error:"no valid selector"}}},pause(){i("pause"),this.__paused=!0},play(){i("play"),this.__paused=!1},togglePlayback(){this.paused()?this.play():this.pause()},paused(){return this.__paused},nextFrame(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw(){if(0!=this.__frameIdx){const t=this.__frames[this.__frameIdx-1];8!=t.disposalMethod&&9!=t.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();const t=this.__frames[this.__frameIdx];if(void 0!==t){this.__clearCanvas();const e=Math.min(this.__width/t.width,this.__height/t.height),s=t.width*e,r=t.height*e,a=(this.__width-s)/2,i=(this.__height-r)/2;this.__ctx.drawImage(t,0,0,t.width,t.height,a,i,s,r),this.__texture.needsUpdate=!0}},__ready({src:t,times:e,cnt:s,frames:r}){i("__ready"),this.__textureSrc=t,this.__delayTimes=e,s?this.__loopCnt=s:this.__infinity=!0,this.__frames=r,this.__frameCnt=e.length,this.__startTime=Date.now();const a=2048;let _=r[0].width,n=r[0].height;if(_>a||n>a){const t=Math.min(a/_,a/n);_=Math.floor(_*t),n=Math.floor(n*t)}this.__width=_,this.__height=n,this.__cnv.width=_,this.__cnv.height=n,this.__texture.needsPowerOfTwo=!1,this.__texture.minFilter=THREE.LinearFilter,this.__texture.magFilter=THREE.LinearFilter,this.__texture.generateMipmaps=!1,this.__texture.colorSpace=THREE.SRGBColorSpace,this.__texture.premultiplyAlpha=!0,this.__texture.repeat.set(1,1),this.__texture.offset.set(0,0),this.__draw(),this.__autoplay?this.play():this.pause()},__reset(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}})})()})();
//# sourceMappingURL=aframe-gif-shader.min.js.map